<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:conv="using:Avalonia.Controls.Converters"
                    xmlns:sys="using:System"
                    xmlns:controls="clr-namespace:ExpressiveWeb.Presentation.Buttons"
                    xmlns:menus="clr-namespace:ExpressiveWeb.Presentation.Menus"
                    x:ClassModifier="internal">

    <ControlTheme x:Key="{x:Type menus:EWMenuItem}"
                  TargetType="menus:EWMenuItem">
        <Setter Property="FontFamily" Value="{DynamicResource ContentControlThemeFontFamily}" />
        <Setter Property="FontSize" Value="{DynamicResource FontSizeNormal}" />
        <Setter Property="MinWidth" Value="220" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Padding" Value="6 3" />
        <Setter Property="Template">
            <ControlTemplate>
                <Border Name="root"
                        Padding="4,0"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="20" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto"
                                              SharedSizeGroup="MenuItemIGT" />
                            <ColumnDefinition Width="20" />
                        </Grid.ColumnDefinitions>
                        <ContentControl Grid.Column="0"
                                        x:Name="PART_ToggleIconPresenter"
                                        IsVisible="False"
                                        Margin="3"
                                        Width="16"
                                        Height="16" />
                        <Rectangle Grid.Column="0" IsVisible="False"
                                   Name="PART_IconPresenter"
                                   Width="18"
                                   Height="18"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Fill="{TemplateBinding IconBrush}" />
                        <ContentPresenter Name="PART_HeaderPresenter"
                                          Grid.Column="1"
                                          Margin="{TemplateBinding Padding}"
                                          VerticalAlignment="Center"
                                          Content="{TemplateBinding Header}"
                                          ContentTemplate="{TemplateBinding HeaderTemplate}">
                            <ContentPresenter.DataTemplates>
                                <DataTemplate DataType="sys:String">
                                    <AccessText Text="{Binding}" />
                                </DataTemplate>
                            </ContentPresenter.DataTemplates>
                        </ContentPresenter>
                        <TextBlock x:Name="PART_InputGestureText"
                                   Grid.Column="2"
                                   VerticalAlignment="Center"
                                   Text="{TemplateBinding InputGesture,
                                              Converter={StaticResource KeyGestureConverter}}" />
                        <Path Name="rightArrow"
                              Grid.Column="3"
                              Margin="10,0,0,0"
                              VerticalAlignment="Center"
                              Width="10" Height="10"
                              Stretch="Uniform"
                              Data="F1 M 0.382568,17.1339C 0.127441,17.3289 0,17.6014 0,17.9514C 0,18.3014 0.112549,18.5889 0.337402,18.8138C 0.5625,19.0389 0.849976,19.1514 1.20007,19.1514C 1.55005,19.1514 1.82251,19.0238 2.01746,18.7689L 10.4624,10.4139C 10.7175,10.1588 10.845,9.87134 10.845,9.55139C 10.845,9.23132 10.7175,8.94385 10.4624,8.68884L 2.01746,0.333862C 1.69751,0.013916 1.31372,-0.0974121 0.866211,0.00012207C 0.418823,0.0976563 0.14624,0.370117 0.0487061,0.817627C -0.0488281,1.26514 0.0625,1.64893 0.382568,1.96887L 7.875,9.55139L 0.382568,17.1339 Z"
                              Fill="{DynamicResource ThemeForegroundBrush}" />
                        <Popup Name="PART_Popup"
                               IsLightDismissEnabled="False"
                               IsOpen="{TemplateBinding IsSubMenuOpen, Mode=TwoWay}"
                               Placement="RightEdgeAlignedTop">
                            <Border Background="{DynamicResource ThemeBackgroundBrush}"
                                    BorderBrush="{DynamicResource ThemeBorderBrush}"
                                    BorderThickness="1" CornerRadius="6" Padding="4">
                                <ScrollViewer Theme="{StaticResource SimpleMenuScrollViewer}">
                                    <ItemsPresenter Name="PART_ItemsPresenter"
                                                    Grid.IsSharedSizeScope="True"
                                                    ItemsPanel="{TemplateBinding ItemsPanel}" />
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>

        <Style Selector="^:separator">
            <Setter Property="Template">
                <ControlTemplate>
                    <Separator />
                </ControlTemplate>
            </Setter>
        </Style>


        <Style Selector="^:pressed /template/ Border#root">
            <Setter Property="Background" Value="{DynamicResource ThemeActiveBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccentBrush}" />
        </Style>

        <Style Selector="^:selected /template/ Border#root">
            <Setter Property="Background" Value="{DynamicResource ThemeHoverBrush}" />
        </Style>

        <Style Selector="^:pointerover /template/ Border#root">
            <Setter Property="Background" Value="{DynamicResource ThemeHoverBrush}" />
        </Style>
        
        <Style Selector="^:empty /template/ Path#rightArrow">
            <Setter Property="IsVisible" Value="False" />
        </Style>

        <Style Selector="^:disabled">
            <Setter Property="Opacity" Value="{DynamicResource ThemeDisabledOpacity}" />
        </Style>

        <Style
            Selector="^:toggle /template/ ContentControl#PART_ToggleIconPresenter, ^:radio /template/ ContentControl#PART_ToggleIconPresenter">
            <Setter Property="IsVisible" Value="True" />
        </Style>
        <Style
            Selector="^:toggle /template/ ContentPresenter#PART_IconPresenter, ^:radio /template/ ContentPresenter#PART_IconPresenter">
            <Setter Property="IsVisible" Value="False" />
        </Style>
        <Style Selector="^:checked:toggle /template/ ContentControl#PART_ToggleIconPresenter">
            <Setter Property="Content">
                <Template>
                    <Path VerticalAlignment="Center"
                          Data="F1M10,1.2L4.7,9.1 4.5,9.1 0,5.2 1.3,3.5 4.3,6.1 8.3,0 10,1.2z"
                          Fill="{Binding $parent[MenuItem].Foreground}" />
                </Template>
            </Setter>
        </Style>
        <Style Selector="^:checked:radio /template/ ContentControl#PART_ToggleIconPresenter">
            <Setter Property="Content">
                <Template>
                    <Ellipse Fill="{Binding $parent[MenuItem].Foreground}"
                             Margin="4" Width="8" Height="8" />
                </Template>
            </Setter>
        </Style>
    </ControlTheme>
</ResourceDictionary>